// ===================================================
// âœ… JavaScript Promises â€“ Introduction Before Async/Await
// ===================================================

// ===================================================
// âœ… What is a Promise?
// ===================================================
/*
ðŸ”¸ A Promise represents the eventual completion (or failure) of an asynchronous operation.
ðŸ”¸ It has three states:
   1. Pending â€“ operation not complete
   2. Fulfilled â€“ operation completed successfully
   3. Rejected â€“ operation failed
ðŸ”¸ Use .then() for success and .catch() for errors
*/

// ===================================================
// âœ… Creating a Simple Promise
// ===================================================

const myPromise = new Promise((resolve, reject) => {
  let success = true; // Change to false to simulate an error

  if (success) {
    resolve("âœ… The operation was successful"); // Resolve the promise
  } else {
    reject("âŒ The operation failed"); // Reject the promise
  }
});

myPromise
  .then(result => console.log(result)) // Handle success
  .catch(error => console.error(error)); // Handle error


// ===================================================
// âœ… Simulating Asynchronous Behavior with setTimeout
// ===================================================

function asyncTask() {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve("ðŸŽ‰ Task completed after 2 seconds"); // Simulated async result
    }, 2000); // Wait 2 seconds
  });
}

asyncTask()
  .then(message => console.log(message)) // Output success message
  .catch(err => console.error("Error:", err)); // Handle any error


// ===================================================
// âœ… Chaining Promises
// ===================================================

function firstStep() {
  return Promise.resolve("Step 1 complete");
}

function secondStep(prevMessage) {
  return Promise.resolve(prevMessage + " â†’ Step 2 complete");
}

firstStep()
  .then(result1 => secondStep(result1)) // Chain second step
  .then(result2 => console.log(result2)) // Final result
  .catch(err => console.error("Error in chain:", err)); // Catch any error in chain


// ===================================================
// âœ… Now that you know Promises...
// ===================================================
/*
You are ready to learn async/await â€“ a simpler way to write the same logic
without chaining .then()/.catch(). It makes your code cleaner.
*/



// ===================================================
// âœ… JavaScript Async & Await â€“ Full Lesson with Comments
// ===================================================


// ===================================================
// âœ… 1. What is async/await?
// ===================================================
/*
ðŸ”¸ async/await is syntax for writing asynchronous code that looks synchronous
ðŸ”¸ Helps you handle promises more clearly than using .then().catch()
ðŸ”¸ Makes code easier to read, debug, and maintain
*/


// ===================================================
// âœ… 2. The async Keyword
// ===================================================
/*
ðŸ”¹ Declares a function as asynchronous
ðŸ”¹ Automatically returns a Promise
*/

async function exampleAsync() {
  return "Hello from async function!"; // Implicitly returns a resolved Promise
}

exampleAsync().then(result => console.log(result)); // Output the resolved value when the promise completes


// ===================================================
// âœ… 3. The await Keyword
// ===================================================
/*
ðŸ”¹ Used inside async functions only
ðŸ”¹ Pauses execution until the Promise resolves
ðŸ”¹ Makes code look synchronous while still being non-blocking
*/

function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms)); // Create a promise that resolves after ms milliseconds
}

async function waitAndPrint() {
  console.log("Wait starts..."); // Log before delay
  await delay(2000); // Wait for 2 seconds
  console.log("âœ… Waited 2 seconds and now prints this"); // Log after the delay
}

waitAndPrint(); // Call the async function


// ===================================================
// âœ… 4. Async/Await with fetch API
// ===================================================

async function fetchPost() {
  try {
    const res = await fetch("https://jsonplaceholder.typicode.com/posts/1"); // Fetch data from API and wait for it

    if (!res.ok) throw new Error("âŒ Failed to fetch post"); // Throw error if response not OK

    const data = await res.json(); // Parse JSON from the response
    console.log("ðŸ“„ Post fetched:", data); // Log the parsed data
  } catch (err) {
    console.error("ðŸš« Error:", err.message); // Catch and log any error
  }
}

fetchPost(); // Call the function to fetch post


// ===================================================
// âœ… 5. Mixing async/await with try...catch
// ===================================================
/*
âœ… Use try...catch blocks to catch any errors that occur inside async functions
âœ… This is similar to .catch() in promises, but cleaner
*/

async function safeDivide(a, b) {
  try {
    if (b === 0) throw new Error("Division by zero"); // Throw error if b is zero
    return a / b; // Return the result of division
  } catch (err) {
    console.error("âŒ Math error:", err.message); // Log the custom error message
  }
}

safeDivide(10, 2); // Expected output: 5
safeDivide(10, 0); // Expected output: âŒ Math error: Division by zero


// ===================================================
// âœ… 6. Summary â€“ async/await Concepts
// ===================================================
/*
ðŸ”¹ async function â†’ automatically returns a Promise
ðŸ”¹ await expression â†’ waits for a Promise to resolve
ðŸ”¹ Makes async code look like normal sync code
ðŸ”¹ Use try...catch for error handling
*/


// ===================================================
// âœ… 7. Bonus: Parallel Async Calls
// ===================================================

async function fetchMultiple() {
  const [post1, post2] = await Promise.all([
    fetch("https://jsonplaceholder.typicode.com/posts/1").then(res => res.json()), // Fetch and parse post 1
    fetch("https://jsonplaceholder.typicode.com/posts/2").then(res => res.json())  // Fetch and parse post 2
  ]);

  console.log("Post 1:", post1); // Log first post
  console.log("Post 2:", post2); // Log second post
}

fetchMultiple(); // Run parallel fetch operations


// ===================================================
// âœ… 8. Real-World Example â€“ User Login and Data Load
// ===================================================
/*
Imagine a scenario where:
1. You need to log in the user (simulate with delay)
2. Then fetch their profile data
3. Then display it on screen
*/

function fakeLogin(user) {
  return new Promise(resolve => {
    setTimeout(() => {
      console.log("ðŸ” Logged in as:", user); // Log the login user name
      resolve({ token: "abc123" }); // Resolve with a mock token
    }, 1000); // Simulate delay of 1 second
  });
}

function fetchProfile(token) {
  return new Promise(resolve => {
    setTimeout(() => {
      console.log("ðŸ“¥ Fetched profile using token:", token); // Log fetched profile message
      resolve({ name: "Alice", age: 30 }); // Resolve with profile data
    }, 1000); // Simulate delay of 1 second
  });
}

async function loginAndLoadProfile() {
  const loginData = await fakeLogin("alice123"); // Step 1: Log in user and wait for token
  const profile = await fetchProfile(loginData.token); // Step 2: Fetch profile with token
  console.log("ðŸ‘¤ User Profile:", profile); // Step 3: Display user profile
}

loginAndLoadProfile(); // Call the full async login and profile loading process

